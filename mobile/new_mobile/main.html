<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=1.0, user-scalable=no"/>
    <title>VIPspeed</title>
    <meta charset="UTF-8">
    <!--在 web app 应用下状态条（屏幕顶部条）的颜色；(改变顶部状态条的颜色)-->
    <!--默认值为 default（白色），可以定为 black（黑色）和 black-translucent（灰色半透明）；-->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="applicable" content="pc,mobile" />
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <link rel="stylesheet" href="css/main.css">
    <style>
        #main{
            background-image: url('images/home_bg.png');
            background-size: cover;
            background-repeat: no-repeat;
        }
        #header {
            margin: 0 auto;
            margin-top: 13px;
            text-align: center;
        }
        #status {
            width:100%;
            height:304px;
        }
        .speed_box {
            display: flex;
            justify-content: space-around;
            margin-top: 70px;
        }
        .status_item {
            width: 113px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }
        .speed_name {
            display: flex;
            justify-content: space-around;
            align-items: center;
            color: #E4E8EB;
        }
        .speed_icon {
            width: 20px;
            height: 14.4px;
        }
        .speed_icon img {
            width: 100%;
        }

        .connect_status {
            width: 89%;
            /*display: flex;*/
            /*justify-content: space-around;*/
            /*align-items: center;*/
            margin: 0 auto;
            margin-top: 70px;
        }
        .img_box {
            text-align: center;
        }

        .line {
            width:14%;
            height:1px;
            background:rgba(0,203,111,1);
            border-radius:100px;
            display: flex;
            justify-content: center;
        }
        .text_box{
            display: flex;justify-content: space-between; text-align: center;
            margin-top: 15px;
        }
        .text_box div{
            white-space: nowrap; display: flex;justify-content: center;
        }
        .connect_num_box {
            width: 149px;
            height:28px;
            background:rgba(38,30,44,1);
            border-radius:100px;
            border:1px solid rgba(255,255,255,1);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            padding: 0 14px;
            margin-top: 60px;
        }
        .red_x {
            width: 12px;
            height: 12px;
            position: relative;
            top:-5px;
            display: none;
        }
    </style>
</head>
<body>
<div id="main">
    <div id="status">
        <div id="header">
            <img style="width: 88px; height: 25px;" src="images/logo.png" alt="">
        </div>
        <div class="speed_box">
            <div class="status_item">
                <div id="bandwidth_output" class="speed_num tlg">{{bandwidth_output}}</div>
                <div class="speed_name">
                    <div class="ts">上传</div>
                    <div style="margin-left: 5px;" class="txs text_gray">bps</div>
                </div>
                <div class="speed_icon">
                    <img src="images/speed_up.png" alt="">
                </div>
            </div>
            <div class="status_item">
                <img src="images/speed_main.png" style="width: 100%;" alt="">
            </div>
            <div class="status_item">
                <div id="bandwidth_input" class="speed_num tlg">{{bandwidth_input}}</div>
                <div class="speed_name">
                    <div class="ts">下载</div>
                    <div style="margin-left: 5px;" class="txs text_gray">bps</div>
                </div>
                <div class="speed_icon">
                    <img src="images/speed_down.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!--显示连接状态-->
    <div class="connect_status">
        <div style="display: flex;justify-content: space-between; align-items: center">
            <img src="images/box_icon.png" style="width: 44px; height: 28px;" alt="盒子">
            <div id="line1" class="line">
                <img class="red_x" src="images/red_x.png" alt="">
            </div>
            <img src="images/network_white.png" style="width: 32px; height: 32px;" alt="当地运营商">
            <div id="line2"  class="line">
                <img class="red_x" src="images/red_x.png" alt="">
            </div>
            <img src="images/database.png" style="width: 30px; height: 31px;" alt="目的地">
        </div>
        <div class="text_box">
            <div style="width: 44px; height: 28px;">盒子</div>
            <div style="width: 32px; height: 32px;">当地运营商</div>
            <div style="width: 30px; height: 31px;">目的地</div>
        </div>
    </div>
    <!--连接数量-->
    <div class="connect_num_box">
        <img style="width: 21px; height: 16px; margin-right: 14px;" src="images/computer.png" alt="">
        <div><span id="devices_num">{{devices_num}}</span>台连接设备</div>
    </div>
    <div style="width:100%;
            height:156px;"></div>
</div>
<footer>
    <div class="footer_nav">
        <img style="width: 26px; height: 23px;" src="images/dashboard_icon_green.png" alt="">
        <div class="text_green">状态</div>
    </div>
    <div class="footer_nav" id="setting">
        <img src="images/setting_icon_gray.png" alt="">
        <div class="text_gray">设置</div>
    </div>
</footer>
<!--<div id="netcard_speed" style="height: 500px"></div>-->
</body>
<script src="js/main.js"></script>
<script src="js/jquery.js"></script>
<script>

  $("#setting").on('click', function() {
    window.location.href = '/admin/mgrStatus';
  });

  var box_idc_status = '{{box_idc_status}}';
  var idc_svr_status = '{{idc_svr_status}}';
  var speed_mode = '{{speed_mode}}';

  updateStatus(box_idc_status, idc_svr_status, speed_mode);

  function updateStatus(box_idc_status, idc_svr_status, speed_mode) {
    if (box_idc_status == 'true' && idc_svr_status == 'true') {
      // all good
      $('#line2').attr('style','background:rgba(0,203,111,1);');
      $('#line1').attr('style','background:rgba(0,203,111,1);');
      $('#line2 .red_x').hide();
      $('#line1 .red_x').hide();
    }
    if (box_idc_status != 'true' && idc_svr_status == 'true') {
      // first bad
      $('#line1').attr('style','background:rgba(255,71,57,1);');
      $('#line2').attr('style','background:rgba(0,203,111,1);');
      $('#line1 .red_x').show();
      $('#line2 .red_x').hide();
    }
    if (box_idc_status == 'true' && idc_svr_status != 'true') {
      // second bad
      $('#line2').attr('style','background:rgba(255,71,57,1);');
      $('#line1').attr('style','background:rgba(0,203,111,1);');
      $('#line2 .red_x').show();
      $('#line1 .red_x').hide();
    }
    if (box_idc_status != 'true' && idc_svr_status != 'true') {
      // all bad
      $('#line2').attr('style','background:rgba(255,71,57,1);');
      $('#line1').attr('style','background:rgba(255,71,57,1);');
      $('#line2 .red_x').show();
      $('#line1 .red_x').show();
    }
  }

  function getStatus() {
    var url = _document_root + 'doGetStatus';
    $.ajax({
      url: url,
      success: function(res) {
        var obj = JSON.parse(res);
        var box_idc_status = `${obj.box_idc_status}`;
        var idc_svr_status = `${obj.idc_svr_status}`;
        var speed_mode = obj.speed_mode;
        var bandwidth_input = `${obj.bandwidth_input}`;
        var bandwidth_output = `${obj.bandwidth_output}`;
        var devices_num = `${obj.devices_num}`;
        $('#bandwidth_input').html(bandwidth_input)
        $('#bandwidth_output').html(bandwidth_output)
        $('#devices_num').html(devices_num)
        updateStatus(box_idc_status, idc_svr_status, speed_mode);
      },
      error: function(error) {
        var obj = JSON.parse(res);
        alert(obj);
      },
    });

  }

  function fn_update_pic() {
    var s = '<img id="main_image" onload="image_loaded()" src=/netcard_temp.png?' + Math.random() + '> </img>';
//    $('#netcard_speed').html(s);
  }

  fn_update_pic();

  function image_loaded() {
    setTimeout(function() {
      $('#main_image').attr('src', `/netcard_temp.png?${Math.random()}`)
    }, 1000)
  }

  function fn_switch_speedmode() {
    var url = _document_root + 'doSwitchSpeedService';
    $.ajax({
      url: url,
      success: function(res) {
        var obj = JSON.parse(res);
        if (obj['Status'] == 'OK') {
          var scheme = $('#myScheme').attr('checked');
          if (scheme) {
            console.log('on to off', scheme);
            $('#myScheme').switchToggle(false)
          } else {
            console.log('off to on', scheme);
            $('#myScheme').switchToggle(true)
          }
        } else {
          alert('Failed');
        }
      },
      error: function(error) {
        var obj = JSON.parse(res);
        alert(obj);
      },
    });
  }

  setInterval('getStatus()', 5000);
</script>
</html>
